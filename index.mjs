// Copyright (c) 2025 The Stdlib Authors. License is Apache-2.0: http://www.apache.org/licenses/LICENSE-2.0
/// <reference types="./index.d.ts" />
import e from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-read-only-property@v0.2.2-esm/index.mjs";import t from"https://cdn.jsdelivr.net/gh/stdlib-js/array-dtype@v0.3.0-esm/index.mjs";import n from"https://cdn.jsdelivr.net/gh/stdlib-js/object-assign@v0.2.2-esm/index.mjs";import r from"https://cdn.jsdelivr.net/gh/stdlib-js/ndarray-base-bytes-per-element@v0.2.2-esm/index.mjs";import{ndarray as i}from"https://cdn.jsdelivr.net/gh/stdlib-js/strided-base-write-dataview@esm/index.mjs";import s from"https://cdn.jsdelivr.net/gh/stdlib-js/strided-base-strided2object@v0.0.0-esm/index.mjs";import o from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-has-wasm-support@v0.2.2-esm/index.mjs";import{isPrimitive as a}from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-nonnegative-integer@v0.2.2-esm/index.mjs";import m from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-collection@v0.2.2-esm/index.mjs";import l from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-arraybuffer@v0.2.2-esm/index.mjs";import u from"https://cdn.jsdelivr.net/gh/stdlib-js/assert-is-function@v0.2.2-esm/index.mjs";import d from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-property@v0.2.1-esm/index.mjs";import h from"https://cdn.jsdelivr.net/gh/stdlib-js/utils-define-nonenumerable-read-only-accessor@v0.2.2-esm/index.mjs";import f from"https://cdn.jsdelivr.net/gh/stdlib-js/array-uint8@v0.2.2-esm/index.mjs";import p from"https://cdn.jsdelivr.net/gh/stdlib-js/array-dataview@v0.2.2-esm/index.mjs";import c from"https://cdn.jsdelivr.net/gh/stdlib-js/math-base-special-ceil@v0.2.2-esm/index.mjs";import{ndarray as b}from"https://cdn.jsdelivr.net/gh/stdlib-js/strided-base-read-dataview@esm/index.mjs";import y from"https://cdn.jsdelivr.net/gh/stdlib-js/string-format@v0.2.2-esm/index.mjs";var v={bool:"uint8",complex64:"complex64",complex128:"complex128",float16:"float16",float32:"float32",float64:"float64",generic:"float64",int8:"int8",int16:"int16",int32:"int32",int64:"int64",uint8:"uint8",uint8c:"uint8",uint16:"uint16",uint32:"uint32",uint64:"uint64"};function g(e){return v[e]||"float64"}var j={};e(j,"array2dtype",(function(e){return g(t(e)||"generic")})),e(j,"arrays2ptrs",(function(e,t){var s,o,a,m,l,u;for(o=[],l=0,u=0;u<t.length;u++)m=t[u],(a=n({},m)).BYTES_PER_ELEMENT=r(m.wdtype),a.nbytes=m.length*a.BYTES_PER_ELEMENT,e.isView(m.data)?(a.ptr=m.data.byteOffset,a.copy=!1):(a.ptr=-1,a.copy=!0,l+=a.nbytes),o.push(a);for(l>0&&e.realloc(l),s=0,u=0;u<o.length;u++)(m=o[u]).copy&&(i(m.length,m.data,m.stride,m.offset,e.view,m.BYTES_PER_ELEMENT,s,!0),m.ptr=s,m.stride=1,m.offset=0,s+=m.nbytes);return o})),e(j,"dtype2wasm",g),e(j,"strided2object",(function(e,t,n,r){var i=s(e,t,n,r);return i.wdtype=g(i.dtype||"generic"),i}));var w="object"==typeof WebAssembly?WebAssembly.Memory:null;var _=o()?w:function(){throw new Error("not implemented")},E=o();function x(e,t,n){if(!(this instanceof x))return new x(e,t,arguments.length>2?n:{});if(!E)throw new Error("unexpected error. Environment does not support WebAssembly.");return l(e)&&(e=new f(e)),this._binary=e,this._module=null,this._instance=null,this._imports=n,t?(this._memory=t,this._view=new p(t.buffer),this._buffer=new f(t.buffer)):(this._memory=null,this._view=null,this._buffer=null),this}h(x.prototype,"binary",(function(){return this._binary.slice()})),h(x.prototype,"memory",(function(){return this._memory})),h(x.prototype,"buffer",(function(){return this._buffer})),h(x.prototype,"view",(function(){return this._view})),h(x.prototype,"exports",(function(){return this._instance?n({},this._instance.exports):null})),d(x.prototype,"initialize",(function(){var e,t;return e=this,t=this._instance?function(t){t(e)}:function(t,n){function r(n,r){e._module=n,e._instance=r,t(e)}function i(e){n(e)}WebAssembly.instantiate(e._binary,e._imports).then(r,i)},new Promise(t)})),d(x.prototype,"initializeAsync",(function(e){var t;if(!u(e))throw new TypeError(y("invalid argument. Must provide a function. Value: `%s`.",e));if(this._instance)return e(null,this);t=this,WebAssembly.instantiate(this._binary,this._imports).then((function(n,r){t._module=n,t._instance=r,e(null,t)}),(function(t){e(t)}))})),d(x.prototype,"initializeSync",(function(){return this._instance||(this._module=new WebAssembly.Module(this._binary),this._instance=new WebAssembly.Instance(this._module,this._imports)),this})),d(x.prototype,"realloc",(function(e){var t;if(!a(e))throw new TypeError(y("invalid argument. Must provide a nonnegative integer. Value: `%s`.",e));if(null===this._memory)return!1;if((t=c((e-this._buffer.length)/65536))>0){try{this._memory.grow(t)}catch(e){return!1}return this._view=new p(this._memory.buffer),this._buffer=new f(this._memory.buffer),!0}return!1})),d(x.prototype,"hasCapacity",(function(e,n){var i;if(!a(e))throw new TypeError(y("invalid argument. First argument must be a nonnegative integer. Value: `%s`.",e));if(!m(n))throw new TypeError(y("invalid argument. Second argument must be an array-like object. Value: `%s`.",n));return null!==this._memory&&(i=r(g(t(n)||"generic")),!(n.length*i+e>this._buffer.length))})),d(x.prototype,"isView",(function(e){if(!m(e))throw new TypeError(y("invalid argument. Must provide an array-like object. Value: `%s`.",e));return!(!this._memory||!e.buffer)&&e.buffer===this._memory.buffer})),d(x.prototype,"write",(function(e,n){var s;if(null===this._memory)throw new Error("invalid invocation. Unable to perform write operation, as the WebAssembly module is not bound to an underlying WebAssembly memory instance.");if(!a(e))throw new TypeError(y("invalid argument. First argument must be a nonnegative integer. Value: `%s`.",e));if(!m(n))throw new TypeError(y("invalid argument. Second argument must be an array-like object. Value: `%s`.",n));if(s=r(g(t(n)||"generic")),n.length*s+e>this._buffer.length)throw new RangeError("invalid argument. Second argument is incompatible with the specified byte offset and available memory. Resize the underlying memory instance in order to accommodate the list of provided values.");return i(n.length,n,1,0,this._view,s,e,!0),this})),d(x.prototype,"read",(function(e,n){var i;if(null===this._memory)throw new Error("invalid invocation. Unable to perform read operation, as the WebAssembly module is not bound to an underlying WebAssembly memory instance.");if(!a(e))throw new TypeError(y("invalid argument. First argument must be a nonnegative integer. Value: `%s`.",e));if(!m(n))throw new TypeError(y("invalid argument. Second argument must be an array-like object. Value: `%s`.",n));if(i=r(g(t(n)||"generic")),n.length*i+e>this._buffer.length)throw new RangeError("invalid argument. Second argument is incompatible with the specified byte offset and available memory. Not enough values to fill the provided output array.");return b(n.length,this._view,i,e,n,1,0,!0),this}));var T={};e(T,"base",j),e(T,"Memory",_),e(T,"ModuleWrapper",x);export{_ as Memory,x as ModuleWrapper,j as base,T as default};
//# sourceMappingURL=index.mjs.map
